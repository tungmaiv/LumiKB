# LumiKB Kubernetes ConfigMaps and Secrets
# Story 7.4: Production Deployment Configuration
# AC-7.4.2: Optional Kubernetes manifests (ConfigMaps, Secrets)
#
# WARNING: This is a template. Replace placeholder values before applying.
# For production, use sealed-secrets, external-secrets, or vault-injector.
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: lumikb-config
  namespace: lumikb
  labels:
    app.kubernetes.io/name: lumikb
    app.kubernetes.io/component: config
data:
  # Application Settings
  LUMIKB_APP_NAME: "LumiKB"
  LUMIKB_ENVIRONMENT: "production"
  LUMIKB_DEBUG: "false"

  # Service Endpoints (internal cluster DNS)
  LUMIKB_REDIS_URL: "redis://lumikb-redis:6379/0"
  LUMIKB_CELERY_BROKER_URL: "redis://lumikb-redis:6379/0"
  LUMIKB_CELERY_RESULT_BACKEND: "redis://lumikb-redis:6379/0"
  LUMIKB_QDRANT_HOST: "lumikb-qdrant"
  LUMIKB_QDRANT_PORT: "6333"
  LUMIKB_MINIO_ENDPOINT: "lumikb-minio:9000"
  LUMIKB_MINIO_SECURE: "false"
  LUMIKB_LITELLM_URL: "http://lumikb-litellm:4000"

  # Embedding/LLM Configuration
  LUMIKB_EMBEDDING_MODEL: "ollama-embedding"
  LUMIKB_LLM_MODEL: "ollama/gemma3:4b"
  LUMIKB_EMBEDDING_BATCH_SIZE: "20"
  LUMIKB_CHUNK_SIZE: "500"
  LUMIKB_CHUNK_OVERLAP: "50"

  # CORS (adjust for your domain)
  LUMIKB_CORS_ORIGINS: '["https://lumikb.example.com"]'

---
apiVersion: v1
kind: Secret
metadata:
  name: lumikb-secrets
  namespace: lumikb
  labels:
    app.kubernetes.io/name: lumikb
    app.kubernetes.io/component: secrets
type: Opaque
stringData:
  # Database Credentials
  # Generate: openssl rand -hex 32
  POSTGRES_USER: "lumikb"
  POSTGRES_PASSWORD: "CHANGE_ME_SECURE_PASSWORD"
  POSTGRES_DB: "lumikb"
  LUMIKB_DATABASE_URL: "postgresql+asyncpg://lumikb:CHANGE_ME_SECURE_PASSWORD@lumikb-postgres:5432/lumikb"

  # MinIO Credentials
  MINIO_ROOT_USER: "lumikb_admin"
  MINIO_ROOT_PASSWORD: "CHANGE_ME_SECURE_PASSWORD"
  LUMIKB_MINIO_ACCESS_KEY: "lumikb_admin"
  LUMIKB_MINIO_SECRET_KEY: "CHANGE_ME_SECURE_PASSWORD"

  # Application Secrets
  # Generate: openssl rand -hex 32
  LUMIKB_SECRET_KEY: "CHANGE_ME_GENERATE_WITH_OPENSSL_RAND_HEX_32"
  LUMIKB_JWT_SECRET: "CHANGE_ME_GENERATE_WITH_OPENSSL_RAND_HEX_32"

  # LiteLLM Master Key
  LITELLM_MASTER_KEY: "sk-CHANGE_ME_GENERATE_SECURE_KEY"
  LUMIKB_LITELLM_API_KEY: "sk-CHANGE_ME_GENERATE_SECURE_KEY"

---
# Optional: LLM Provider API Keys (create if using cloud providers)
apiVersion: v1
kind: Secret
metadata:
  name: lumikb-llm-keys
  namespace: lumikb
  labels:
    app.kubernetes.io/name: lumikb
    app.kubernetes.io/component: llm-secrets
type: Opaque
stringData:
  # Uncomment and set the providers you're using
  # OPENAI_API_KEY: "sk-..."
  # ANTHROPIC_API_KEY: "sk-..."
  # GEMINI_API_KEY: "..."
  OLLAMA_API_BASE: ""  # Leave empty if not using Ollama
