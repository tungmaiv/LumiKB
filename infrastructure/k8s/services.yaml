# LumiKB Kubernetes Services
# Story 7.4: Production Deployment Configuration
# AC-7.4.2: Optional Kubernetes manifests (Services)
---
# API Service - Internal ClusterIP for backend communication
apiVersion: v1
kind: Service
metadata:
  name: lumikb-api
  namespace: lumikb
  labels:
    app.kubernetes.io/name: lumikb
    app.kubernetes.io/component: api
spec:
  type: ClusterIP
  ports:
    - name: http
      port: 8000
      targetPort: http
      protocol: TCP
  selector:
    app.kubernetes.io/name: lumikb
    app.kubernetes.io/component: api

---
# Frontend Service - LoadBalancer for external access
# In cloud environments, this creates a cloud load balancer
# For on-prem, use NodePort or Ingress instead
apiVersion: v1
kind: Service
metadata:
  name: lumikb-frontend
  namespace: lumikb
  labels:
    app.kubernetes.io/name: lumikb
    app.kubernetes.io/component: frontend
spec:
  type: LoadBalancer
  ports:
    - name: http
      port: 80
      targetPort: http
      protocol: TCP
  selector:
    app.kubernetes.io/name: lumikb
    app.kubernetes.io/component: frontend

---
# PostgreSQL Service - Internal ClusterIP
apiVersion: v1
kind: Service
metadata:
  name: lumikb-postgres
  namespace: lumikb
  labels:
    app.kubernetes.io/name: lumikb
    app.kubernetes.io/component: postgres
spec:
  type: ClusterIP
  ports:
    - name: postgres
      port: 5432
      targetPort: 5432
      protocol: TCP
  selector:
    app.kubernetes.io/name: lumikb
    app.kubernetes.io/component: postgres

---
# Redis Service - Internal ClusterIP
apiVersion: v1
kind: Service
metadata:
  name: lumikb-redis
  namespace: lumikb
  labels:
    app.kubernetes.io/name: lumikb
    app.kubernetes.io/component: redis
spec:
  type: ClusterIP
  ports:
    - name: redis
      port: 6379
      targetPort: 6379
      protocol: TCP
  selector:
    app.kubernetes.io/name: lumikb
    app.kubernetes.io/component: redis

---
# MinIO Service - Internal ClusterIP
apiVersion: v1
kind: Service
metadata:
  name: lumikb-minio
  namespace: lumikb
  labels:
    app.kubernetes.io/name: lumikb
    app.kubernetes.io/component: minio
spec:
  type: ClusterIP
  ports:
    - name: api
      port: 9000
      targetPort: 9000
      protocol: TCP
    - name: console
      port: 9001
      targetPort: 9001
      protocol: TCP
  selector:
    app.kubernetes.io/name: lumikb
    app.kubernetes.io/component: minio

---
# Qdrant Service - Internal ClusterIP
apiVersion: v1
kind: Service
metadata:
  name: lumikb-qdrant
  namespace: lumikb
  labels:
    app.kubernetes.io/name: lumikb
    app.kubernetes.io/component: qdrant
spec:
  type: ClusterIP
  ports:
    - name: http
      port: 6333
      targetPort: 6333
      protocol: TCP
    - name: grpc
      port: 6334
      targetPort: 6334
      protocol: TCP
  selector:
    app.kubernetes.io/name: lumikb
    app.kubernetes.io/component: qdrant

---
# LiteLLM Service - Internal ClusterIP
apiVersion: v1
kind: Service
metadata:
  name: lumikb-litellm
  namespace: lumikb
  labels:
    app.kubernetes.io/name: lumikb
    app.kubernetes.io/component: litellm
spec:
  type: ClusterIP
  ports:
    - name: http
      port: 4000
      targetPort: 4000
      protocol: TCP
  selector:
    app.kubernetes.io/name: lumikb
    app.kubernetes.io/component: litellm
