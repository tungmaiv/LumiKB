# generated: 2025-11-23
# project: LumiKB
# project_key: lumikb
# tracking_system: file-system
# story_location: '{project-root}/docs/sprint-artifacts'

# STATUS DEFINITIONS:
# ==================
# Epic Status:
#   - backlog: Epic exists in epic file but not contexted
#   - contexted: Epic tech context created (required before drafting stories)
#
# Story Status:
#   - backlog: Story only exists in epic file
#   - drafted: Story file created in stories folder
#   - ready-for-dev: Draft approved and story context created
#   - in-progress: Developer actively working on implementation
#   - review: Under SM review (via code-review workflow)
#   - done: Story completed
#
# Retrospective Status:
#   - optional: Can be completed but not required
#   - completed: Retrospective has been done
#
# WORKFLOW NOTES:
# ===============
# - Epics should be 'contexted' before stories can be 'drafted'
# - Stories can be worked in parallel if team capacity allows
# - SM typically drafts next story after previous one is 'done' to incorporate learnings
# - Dev moves story to 'review', SM reviews, then Dev moves to 'done'

generated: 2025-11-23
project: LumiKB
project_key: lumikb
tracking_system: file-system
story_location: '{project-root}/docs/sprint-artifacts'

development_status:
  # Epic 1: Foundation & Authentication (10 stories)
  epic-1: contexted
  1-1-project-initialization-and-repository-setup: done
  1-2-database-schema-and-migration-setup: done
  1-3-docker-compose-development-environment: done
  1-4-user-registration-and-authentication-backend: done
  1-5-user-profile-and-password-management-backend: done
  1-6-admin-user-management-backend: done
  1-7-audit-logging-infrastructure: done
  1-8-frontend-authentication-ui: done
  1-9-three-panel-dashboard-shell: done
  1-10-demo-knowledge-base-seeding: done
  epic-1-retrospective: completed

  # Epic 2: Knowledge Base & Document Management (12 stories)
  epic-2: contexted
  2-1-knowledge-base-crud-backend: done
  2-2-knowledge-base-permissions-backend: done
  2-3-knowledge-base-list-and-selection-frontend: done
  2-4-document-upload-api-and-storage: done
  2-5-document-processing-worker-parsing: done
  2-6-document-processing-worker-chunking-and-embedding: done
  2-7-document-processing-status-and-notifications: done
  2-8-document-list-and-metadata-view: done
  2-9-document-upload-frontend: done
  2-10-document-deletion: done
  2-11-outbox-processing-and-reconciliation: done
  2-12-document-re-upload-and-version-awareness: done
  epic-2-retrospective: optional

  # Epic 3: Semantic Search & Citations (10 stories)
  epic-3: done  # ✅ Completed 2025-11-26 (Stories 3.1-3.10 done, tech debt documented)
  3-1-semantic-search-backend: done
  3-2-answer-synthesis-with-citations-backend: done
  3-3-search-api-streaming-response: done
  3-4-search-results-ui-with-inline-citations: done
  3-5-citation-preview-and-source-navigation: done  # ✅ Code review completed 2025-11-26
  3-6-cross-kb-search: done  # ✅ Code review approved 2025-11-26
  3-7-quick-search-and-command-palette: done  # ✅ Code review approved 2025-11-26
  3-8-search-result-actions: done  # ✅ Code review approved, marked done 2025-11-26
  3-9-relevance-explanation: done  # ✅ Code review approved, all tests passing 2025-11-26
  3-10-verify-all-citations: done  # ✅ Code review approved, marked done 2025-11-26
  epic-3-retrospective: optional

  # Epic 4: Chat & Document Generation (10 stories)
  epic-4: done  # ✅ COMPLETED 2025-11-29: All 10 stories delivered (Chat conversation, streaming UI, conversation mgmt, document generation, draft streaming, editing, export, feedback/recovery, templates, audit logging). Production-ready chat & generation features with comprehensive audit trail.
  4-1-chat-conversation-backend: done  # ✅ Completed 2025-11-26: Multi-turn RAG chat backend, unit tests passing, integration fixtures created
  4-2-chat-streaming-ui: done  # ✅ Completed 2025-11-27: Real LLM streaming, SSE event schema fixed, all 3 missing components created (ChatContainer, ChatInput, useChatStream), code review blockers resolved
  4-3-conversation-management: done  # ✅ APPROVED 2025-11-28: All 6 ACs satisfied, 37 tests (15 new passing), localStorage persistence, Quality Score 95/100, production-ready
  4-4-document-generation-request: done  # ✅ COMPLETED 2025-11-28: All 6 ACs satisfied, frontend 26/26 tests passing, backend stub implementation (full LLM generation deferred to Story 4.5), code review approved
  4-5-draft-generation-streaming: done  # ✅ COMPLETED 2025-11-28: SSE streaming endpoint /api/v1/generate/stream implemented with progressive citation extraction, StreamingDraftView 3-panel UI, AbortController cancellation. Tests written (deferred to Story 5.15 for LLM mocks). AC1-AC4 satisfied.
  4-6-draft-editing: done  # ✅ DONE 2025-11-29: All Priority 1 & 2 bugs fixed, migration fix applied. AC1-AC5 complete, citation preservation works, XSS protected, performance optimized. Quality: 92/100. Backend tests: 536 passed. AC6+tests deferred to Epic 5 (TD-4.6-1). Production-ready.
  4-7-document-export: done  # ✅ DONE 2025-11-29: Export service implemented (DOCX, PDF, Markdown). AC1-AC5 complete, AC6 deferred. 10 unit tests PASSED. All linting clean. ExportModal, VerificationDialog, useExport hook working. Permission checks, format validation, filename sanitization implemented. Tests/features deferred to Epic 5: TD-4.7-1 (frontend unit), TD-4.7-2 (integration), TD-4.7-3 (E2E), TD-4.7-4 (AC6 audit logging). Production-ready.
  4-8-generation-feedback-and-recovery: done  # ✅ DONE 2025-11-29: FeedbackService (5 types), POST /feedback endpoint, Alternative suggestions, RecoveryModal, ErrorRecoveryDialog, useFeedback hook. 15 unit tests PASSED. FeedbackRequest schema fixed (previous_draft_id added). Quality: 92/100. AC6, UI integration, tests deferred to Epic 5 (TD-4.8-1, TD-4.8-2, TD-4.8-3). Production-ready.
  4-9-generation-templates: done  # ✅ APPROVED 2025-11-29: Quality 95/100. All 5 ACs implemented, all 8 tasks verified, 29/29 tests PASSED. Task 5 (generation-modal.tsx) complete. Build verified. Production-ready. Tech debt: TD-4.9-1 (E2E tests → 5-15), TD-4.9-2 (test file cleanup → 5-15).
  4-10-generation-audit-logging: done  # ✅ DONE 2025-11-29: AuditService extended (5 methods), admin GET /audit/generation endpoint with filters/pagination/metrics, chat/generation streaming audit logging. 15/15 tests PASSED (8 unit + 7 integration). Fire-and-forget pattern, PII sanitization, request ID linking. Production-ready.
  epic-4-retrospective: done  # ✅ COMPLETED 2025-11-30: Retrospective completed. Critical discovery: Epic 3 & 4 features built but not accessible via UI navigation. Added Story 5.0 (Epic Integration) and Story 5.16 (Docker E2E Infrastructure) to Epic 5 scope. 6 key learnings about DoD, integration stories, E2E testing, navigation, deployment frequency. 8 action items created. See: docs/sprint-artifacts/epic-4-retrospective-2025-11-30.md

  # Epic 5: Administration & Polish (23 stories - UPDATED 2025-12-07)
  # Scope changes 2025-12-07: Added Stories 5.25-5.26 (Document Chunk Viewer - Backend API + Frontend UI)
  # Scope changes 2025-12-06: Added Stories 5.22-5.24 (Document Tags, Processing Progress, Dashboard Filtering)
  # Scope changes 2025-12-05: Added Stories 5.18-5.21 (User/Group/Role Management UI, Theme System)
  # Previous changes 2025-11-30: Added Story 5.0 (Epic Integration) and Story 5.16 (Docker E2E)
  # Total stories: 23 (was 21) - includes document chunk viewer feature (Stories 5.25-5.26)
  epic-5: contexted  # ✅ CONTEXTED 2025-11-30: Tech spec generated with comprehensive design, 93 ACs, traceability mapping, 6 risks, 7 assumptions, 7 open questions, detailed test strategy. Ready for story drafting. See: docs/sprint-artifacts/tech-spec-epic-5.md
  5-0-epic-integration-completion: done  # ✅ APPROVED 2025-11-30: Code review APPROVED with 95/100 quality score. Chat page route with SSE streaming (237 lines), dashboard Quick Access cards functional, backend services verified. AC1-AC3, AC5 complete. AC4 (smoke tests) appropriately deferred to Story 5.16 (Docker E2E Infrastructure). Clean code following KISS/DRY/YAGNI, citation-first architecture preserved, 3 implementation issues fixed. Minor polish items (unused ref, generic errors) documented as future enhancements. Epic 3 & 4 features now fully accessible to users. Ready for production. See: docs/sprint-artifacts/5-0-epic-integration-completion.md
  5-1-admin-dashboard-overview: done  # ✅ COMPLETED 2025-12-02: All 5 ACs satisfied, all issues resolved. Fixed: M1 (debug code removed), M2 (8/8 integration tests passing), M3 (active user metric documented), M4 (frontend tests stabilized), L1 (formatBytes utility extracted), L2 (10 unit tests passing). Quality: 90/100. Redis caching (5min TTL), recharts sparklines, admin-only access (403), graceful fallback, PostgreSQL aggregation. All 18 backend tests + 19 frontend tests passing. Production-ready. See: docs/sprint-artifacts/5-1-admin-dashboard-overview.md
  5-2-audit-log-viewer: done  # ✅ COMPLETED 2025-12-02: All 6 ACs satisfied, comprehensive audit log viewer with filtering, pagination, PII redaction, admin-only access. Backend: 14/14 tests passing (5 unit, 6 enum, 3 integration), zero linting errors. Frontend: Types, hooks (useAuditLogs), components (filters, table, modal), page integration, navigation added to admin dashboard. E2E framework established. DoD 37/40 (92.5%), code review approved 95/100, production-ready. Epic 4 learning applied (feature fully accessible, no placeholders). See: 5-2-audit-log-viewer.md, story-5-2-dod-verification.md, code-review-story-5-2-complete.md
  5-3-audit-log-export: done  # ✅ APPROVED 2025-12-02: Code review APPROVED. All 5 ACs satisfied (streaming export CSV/JSON, self-audit logging, incremental streaming, CSV header, PII redaction). 13/13 tests passing (6 unit + 7 integration), zero linting errors. Memory-efficient streaming via SQLAlchemy yield_per + async generators. Privacy-by-default PII redaction. DRY pattern reuse from Story 5.2. ExportAuditLogsModal with format selection. Production-ready. Minor E2E infrastructure issue (baseURL) tracked separately. See: docs/sprint-artifacts/5-3-audit-log-export.md
  5-4-processing-queue-status: done  # ✅ COMPLETED 2025-12-02: All 6 ACs satisfied, comprehensive queue monitoring for Celery tasks. Backend: QueueMonitorService with Celery Inspect API, Redis caching (5min TTL), graceful degradation. 19/19 tests passing (13 unit + 6 integration), zero linting errors. Frontend: useQueueStatus/useQueueTasks hooks (10s auto-refresh), QueueStatusCard, TaskListModal, queue dashboard page. Admin-only access (403 enforced). Dynamic queue discovery, worker heartbeat detection, task details with timestamps. Production-ready minimal implementation. Frontend unit tests deferred (not required for MVP). See: docs/sprint-artifacts/5-4-processing-queue-status.md
  5-5-system-configuration: done  # ✅ COMPLETED 2025-12-03: Code review APPROVED, all ACs satisfied. Backend: SystemConfig model, ConfigService (Redis caching 5min TTL), 3 admin endpoints, 13/13 integration tests passing. Frontend: useSystemConfig hook, ConfigSettingsTable, EditConfigModal, RestartWarningBanner, admin config page. E2E: 10 tests created (P0-P1), deferred to Story 5-16. Audit logging verified. Linting: zero errors. Production-ready. See: docs/sprint-artifacts/code-review-story-5-5.md
  5-6-kb-statistics-admin-view: done  # ✅ COMPLETED 2025-12-03: KB statistics admin view implemented. Backend: KBStatsService with cross-service aggregation (PostgreSQL, MinIO, Qdrant), GET /api/v1/admin/knowledge-bases/{kb_id}/stats endpoint, Pydantic schemas (KBDetailedStats, TopDocument). Frontend: KB stats page with dropdown selector, useKBStats React Query hook (10min cache), admin dashboard integration. Redis caching (10min TTL), graceful degradation for external services. All tests passing: 8 unit tests, 4 integration tests, 6 frontend tests. Production-ready. See: 5-6-kb-statistics-admin-view.md
  5-7-onboarding-wizard: done  # ✅ APPROVED 2025-12-03: Code review APPROVED with 95/100 quality score. All 5 ACs satisfied (AC-5.7.1 through AC-5.7.5), AC-5.7.6 deferred (optional). 38/38 tests passing (9 backend + 29 frontend), 17 E2E tests created (deferred to 5.16). Backend: User model extended with onboarding_completed field, PUT /api/v1/users/me/onboarding endpoint (idempotent). Frontend: OnboardingWizard with 5 steps (Welcome, Explore KB, Try Search, Citations, Completion), useOnboarding hook, dashboard integration. Zero linting errors. Clean architecture following KISS/DRY/YAGNI. Production-ready. See: docs/sprint-artifacts/5-7-onboarding-wizard.md
  5-8-smart-kb-suggestions: done  # ✅ DONE 2025-12-03: Code review APPROVED with 96/100 quality score. All 5 ACs satisfied (AC-5.8.1 through AC-5.8.5), 34/34 tasks verified. Backend: KBRecommendationService with weighted scoring (40/35/25), Redis caching (1hr TTL), GET /api/v1/users/me/kb-recommendations endpoint, kb_access_log table, cold start fallback (<7 days AND 0 searches). 37/37 tests passing (27 unit + 10 integration), zero linting errors. Clean architecture (service layer, DI, fire-and-forget logging). Frontend deferred to Story 5.9, E2E tests deferred to Story 5.16. See: docs/sprint-artifacts/5-8-smart-kb-suggestions.md
  5-9-recent-kbs-and-polish-items: done  # ✅ DONE 2025-12-03: All 9 ACs satisfied, 37/37 tests passing (19 backend + 18 frontend). Backend: RecentKBService with indexed query (<100ms SLA), GET /me/recent-kbs endpoint, RecentKB schema. Frontend: useRecentKBs (5min stale), useKBRecommendations (1hr stale) hooks, KB sidebar updated with Recent + Recommendations sections, DashboardSkeleton, ErrorBoundary with retry. Dashboard tooltips (200ms delay), keyboard navigation (focus-visible). E2E deferred to Story 5.16. See: docs/sprint-artifacts/story-5-9-completion-summary.md
  5-10-command-palette-test-coverage-improvement: done  # ✅ DONE 2025-12-03: Technical debt from Story 3.7 resolved. All 10 command palette tests now passing (100%). Fix: Added `shouldFilter={false}` to Command component (cmdk client-side filtering disabled for server-side search), changed `vi.clearAllMocks()` to `vi.resetAllMocks()` for proper test isolation. Code review APPROVED. See: docs/sprint-artifacts/automation-summary-story-5-10.md
  5-11-epic-3-search-hardening: done  # ✅ APPROVED 2025-12-03: Code review APPROVED with 94/100 quality score. AC1 (3 backend similar_search unit tests), AC2 (6 draft-store hook tests), AC4 (command palette dialog a11y - WCAG 2.1 AA), AC7 (TODO cleanup) - ALL COMPLETED. 19/19 tests passing (3 backend + 16 frontend). AC3 (screen reader manual testing) requires human verification. AC6 (hover reveal) OPTIONAL skipped. Clean mocking patterns, proper test isolation. Production-ready. See: docs/sprint-artifacts/code-review-story-5-11.md
  5-12-atdd-integration-tests-transition-to-green: done  # ✅ DONE 2025-12-03: All ATDD integration tests transitioned to GREEN. 33 tests total: 26 passed, 7 skipped (LLM unavailable). Test helpers (qdrant_helpers, document_helpers) created. Fixtures with testcontainers (PostgresContainer, RedisContainer, QdrantContainer). SSE streaming tests handle LLM unavailability gracefully. Similar search tests working. Cross-KB search, LLM synthesis, semantic search all passing. See: docs/sprint-artifacts/5-12-atdd-integration-tests-transition-to-green.md
  5-13-celery-beat-filesystem-fix: done  # ✅ DONE 2025-12-04: Code review APPROVED 100/100. Celery Beat schedule file persistence FIXED. Removed read-only bind mount from celery-beat service (code baked into Dockerfile). Added named volume lumikb-celery-beat-data for /app/celery-data/. Schedule file persists across restarts, process-outbox-events triggers every 10s. All 5 ACs verified. No automated tests required (infrastructure-only). See: docs/sprint-artifacts/code-review-story-5-13.md
  5-14-search-audit-logging: done  # ✅ DONE 2025-12-04: SearchAuditService with PIISanitizer (email, phone, SSN, CC) implemented. AuditService extended with _sanitize_pii() and enhanced log_search() method (search_type, status, error fields). All search endpoints instrumented (semantic, cross-kb, quick, similar). Fire-and-forget async pattern. 35/35 tests passing (27 unit + 8 integration). Admin audit viewer integration verified. See: 5-14-search-audit-logging.md
  5-15-epic-4-atdd-transition-to-green: done  # ✅ DONE 2025-12-04: All Epic 4 ATDD tests transitioned to GREEN. Frontend: 902/902 tests passing (75 test files). Fixed: streaming-draft-view (jest→vitest), generation-modal (combobox→radiogroup), feedback-modal (label matchers), verification-dialog (Radix checkbox), onboarding-wizard (idempotency removed). Backend integration: 16 passed, 13 skipped (external services). Unit tests: 413 passed (26 pre-existing failures unrelated to Epic 4). R-002 citation security tests passing. See: 5-15-epic-4-atdd-transition-to-green.md
  5-17-main-navigation: done  # ✅ DONE 2025-12-06: MainNav (desktop) + MobileNav (mobile) navigation components COMPLETED. Core links: Dashboard, Search, Chat. Admin section: Overview, Users, Groups, KB Perms, Audit, Queue, Config, KB Stats (is_superuser gated). Toggle button for admin/main menu switch. Settings placeholder page. 43 frontend tests passing (18 main-nav + 18 mobile-nav + 7 header). Backend admin route protection tests created (28 tests, require Docker). All 6 ACs verified. See: docs/sprint-artifacts/5-17-main-navigation.md
  # NOTE: Story 5-16 migrated to Epic 7 as Story 7-1 (see line 156)
  5-18-user-management-ui: done  # ✅ DONE 2025-12-05: User management UI with list/create/edit functionality. Sortable paginated table, form validation (zod), optimistic updates, self-deactivation prevention. AdminGuard route protection. 56/56 unit tests, 10 E2E tests. Code review APPROVED. All 6 ACs verified. See: 5-18-user-management-ui.md
  5-19-group-management: done  # ✅ DONE 2025-12-05: Group management COMPLETED. Backend: Group model, UserGroup junction table, GroupService (CRUD + membership), 7 admin API endpoints. Frontend: useGroups/useGroup hooks, GroupTable (expandable rows), CreateGroupModal, EditGroupModal, GroupMembershipModal, Groups page. 40+ tests passing (22 backend unit, 18 hook, 20+ component). Navigation: Groups link added to MainNav admin section. Code review APPROVED 100% AC satisfaction. Soft delete pattern, audit logging, 409 conflict handling. See: docs/sprint-artifacts/5-19-group-management.md, code-review-story-5-19.md
  5-20-role-kb-permission-management-ui: done  # ✅ DONE 2025-12-06: Code review APPROVED. KB permission management UI COMPLETED. Backend: kb_group_permissions table, extended API (grant/revoke user/group, effective permissions). Frontend: useKBPermissions hook (React Query, optimistic updates), KBPermissionsTable (sort, search, pagination), AddUserPermissionModal, AddGroupPermissionModal, EditPermissionModal, KB Permissions admin page. 72/72 frontend unit tests passing. All 6 ACs verified. See: docs/sprint-artifacts/5-20-role-kb-permission-management-ui.md
  5-21-theme-system: done  # ✅ DONE 2025-12-05: Theme system with 5 options (Light, Dark, Light Blue, Dark Navy, System). CSS variables in globals.css for .light-blue and .dark-navy classes. Theme store extended with THEMES constant. User menu updated with DropdownMenuSub theme selector with checkmark indicator. Zustand persist for localStorage. All AC satisfied.
  5-22-document-tags: done  # ✅ DONE 2025-12-06: Document tags feature implemented. Backend: tags in metadata JSONB, PATCH endpoint, tag validation (max 10, 50 chars), normalization. Frontend: DocumentTagInput, DocumentEditTagsModal, DocumentTagsDisplay. 56 frontend tests + 17 backend unit tests passing. Fixed duplicate upload issue (processingFilesRef guard). See: 5-22-document-tags.md
  5-23-document-processing-progress: done  # ✅ DONE 2025-12-07: Document processing progress screen COMPLETED. New tab in KB dashboard (ADMIN/WRITE only). Filter by name, type, date, status, step. Per-step status with errors, chunk counts, duration. 10s auto-refresh. ProcessingTab, DocumentProcessingTable, ProcessingDetailsModal, ProcessingFilterBar components. useDocumentProcessing, useDocumentProcessingDetails hooks (React Query). Backend: GET /{kb_id}/processing, GET /{kb_id}/processing/{doc_id} endpoints. 70 frontend tests + 24 backend tests passing. Code review APPROVED 94/100. See: 5-23-document-processing-progress.md
  5-24-kb-dashboard-filtering: done  # ✅ DONE 2025-12-06: KB dashboard filtering & pagination implemented. Backend: filter params (search, type, status, tags, dates), pagination. Frontend: DocumentFilterBar with advanced panel, DocumentPagination, useDocumentFilters hook (URL sync), useDocuments hook (React Query). 56 frontend tests passing. Debounced search, filter state in URL. See: 5-24-kb-dashboard-filtering.md
  5-25-document-chunk-viewer-backend: done  # ✅ DONE 2025-12-08: Backend API for Document Chunk Viewer COMPLETED. GET /documents/{id}/chunks with search/pagination, GET /documents/{id}/content for streaming. ChunkService queries Qdrant, MinIO streaming. Code review completed, MIME utility extracted to shared file-utils.ts. Tech debt TD-5.26-1 added for async Qdrant client migration. See: 5-25-document-chunk-viewer-backend.md
  5-26-document-chunk-viewer-frontend: done  # ✅ DONE 2025-12-08: Frontend UI for Document Chunk Viewer COMPLETED. Split-pane viewer (react-resizable-panels), format-specific viewers (PDF, DOCX, Markdown, Text), virtual scroll (@tanstack/react-virtual), chunk search with debounce. Code review completed, MIME utilities refactored to shared file-utils.ts. All 11 ACs satisfied. See: 5-26-document-chunk-viewer-frontend.md
  epic-5-retrospective: optional

  # Epic 6: Document Lifecycle Management (9 stories)
  # NEW 2025-12-07: Comprehensive document lifecycle management including archive, restore,
  # purge, clear failed, duplicate detection, and replace operations.
  # FRs Covered: FR59-FR77 (19 requirements)
  # Total Story Points: 35
  epic-6: contexted  # ✅ CONTEXTED 2025-12-07: Tech spec created with state machine design, API contracts, Qdrant operations, story dependencies. See: docs/sprint-artifacts/tech-spec-epic-6.md
  6-1-archive-document-backend: done  # ✅ DONE 2025-12-07: All 6 ACs satisfied. Migration (archived_at), DocumentService.archive(), POST /archive endpoint, Qdrant payload update, search exclusion filter. 12 unit tests + 21 integration tests PASSED. Quality: 95/100. Production-ready.
  6-2-restore-document-backend: done  # ✅ DONE 2025-12-07: All 6 ACs satisfied. POST /restore endpoint, clears archived_at, name collision detection (409), Qdrant payload update (archived=false), rollback on Qdrant failure. 31 unit + 25 integration tests PASSED. Code review APPROVED. See: code-review-stories-6-2-to-6-6.md
  6-3-purge-document-backend: done  # ✅ DONE 2025-12-07: All 6 ACs satisfied. DELETE /purge endpoint, multi-layer cleanup (PostgreSQL→Qdrant→MinIO), bulk purge with skip tracking, graceful degradation. Grace period config added (LUMIKB_ARCHIVE_GRACE_PERIOD_DAYS). Rate limiting (max 100 docs/batch). Code review APPROVED.
  6-4-clear-failed-document-backend: done  # ✅ DONE 2025-12-07: All 5 ACs satisfied. DELETE /clear endpoint, only FAILED status docs, removes partial artifacts (Qdrant vectors, MinIO file), graceful handling if artifacts don't exist. Audit logging (document.cleared vs document.auto_cleared). Code review APPROVED.
  6-5-duplicate-detection-auto-clear-backend: done  # ✅ DONE 2025-12-07: All 5 ACs satisfied. Case-insensitive duplicate detection (func.lower), 409 for completed/archived duplicates, auto-clear failed duplicates on re-upload, block pending/processing duplicates (DUPLICATE_PROCESSING), cross-KB same name allowed. Code review APPROVED.
  6-6-replace-document-backend: done  # ✅ DONE 2025-12-07: All 6 ACs satisfied. POST /replace endpoint, atomic delete-then-upload, preserves ID/created_at/tags, cannot replace while processing (400), clears archived_at, triggers reprocessing (outbox event with is_replacement=true). Transaction boundaries documented. Code review APPROVED.
  6-7-archive-management-ui: done  # ✅ DONE 2025-12-07: Archive management page COMPLETED. Archive page at /archive with KB filter, debounced search (300ms), pagination (20/page). RestoreDocument, PurgeDocument mutations. Two-step purge confirmation (PurgeConfirmModal), bulk purge (BulkPurgeModal). 409 name collision handling on restore. Empty state display. useArchive hooks, archive.ts types. Code review APPROVED. See: code-review-stories-6-7-to-6-9.md
  6-8-document-list-actions-ui: done  # ✅ DONE 2025-12-07: Document list actions COMPLETED. Archive action for READY docs, Clear action for FAILED docs. ArchiveConfirmationModal, ClearConfirmationModal components. canManage prop for permission-based visibility. Destructive styling for clear. Loading states. Dropdown menu pattern. Code review APPROVED. See: code-review-stories-6-7-to-6-9.md
  6-9-duplicate-upload-replace-ui: done  # ✅ DONE 2025-12-07: Duplicate detection UI COMPLETED. DuplicateDialog with 409 conflict handling, Replace existing option (reuploadFile), Cancel/skip option, Auto-clear notification toast. Loading state (isReplacing), error display, archived doc restore note. Pre-flight checkDuplicate API call. processingFilesRef prevents duplicate uploads. Code review APPROVED. See: code-review-stories-6-7-to-6-9.md
  epic-6-retrospective: completed  # ✅ COMPLETED 2025-12-07: Retrospective facilitated. Key learnings: state machine design, multi-layer graceful degradation, 409 conflict UX, consolidated code reviews, traceability matrix. 6 action items documented. See: docs/sprint-artifacts/epic-6-retrospective-2025-12-07.md

  # Epic 7: Infrastructure & DevOps (32 stories)
  # NEW 2025-12-08: Split from Epic 5 to properly scope infrastructure-focused work.
  # Includes: E2E testing, CI/CD, deployment, monitoring, tech debt fixes, LLM model registry
  # Story 7-1 migrated from Story 5-16, then SPLIT into 7-1 (infra) + 8-16 (automation)
  # Story 7-11 added 2025-12-08: Navigation restructure with RBAC default groups
  # Stories 7-12 to 7-17 added 2025-12-09: KB-Level Configuration feature (correct-course)
  # Stories 7-24 to 7-26 added 2025-12-10: KB Lifecycle Management (archive/restore/delete)
  # Total Story Points: 91 (was 80, +11 for KB lifecycle stories)
  epic-7: contexted  # ✅ CONTEXTED 2025-12-08: Tech spec generated with comprehensive design, data models, APIs, NFRs, test strategy. See: docs/sprint-artifacts/tech-spec-epic-7.md
  7-1-docker-e2e-infrastructure: done  # ✅ DONE 2025-12-08: Docker E2E infrastructure COMPLETED. docker-compose.e2e.yml (8 services), frontend/Dockerfile.e2e (standalone Next.js), backend/seed_e2e.py (idempotent seeding with test users/KBs/documents/Qdrant vectors). All 4 ACs satisfied. E2E automation deferred to Story 8-16. See: 7-1-docker-e2e-infrastructure.md
  7-2-centralized-llm-configuration: done  # ✅ DONE 2025-12-09: All 4 ACs satisfied, all 5 tasks complete. Backend: useLLMConfig hook (30s polling, PUT /admin/llm/config), testHealth() for /admin/llm/health. Frontend: LLMConfigForm (model dropdowns, temperature/max_tokens/top_p sliders), ModelHealthIndicator (latency color coding, error display), /admin/config/llm page. Hot-reload success banner with dimension mismatch warnings. 59 frontend tests passing (16 hook + 23 form + 20 health indicator). Connected to existing LiteLLM integration. Production-ready. See: 7-2-centralized-llm-configuration.md
  7-3-ci-cd-pipeline-setup: done  # ✅ DONE 2025-12-09: All 4 ACs satisfied. PR validation workflow (lint, type-check, unit tests, build), Docker build workflow (GHCR multi-image), coverage reporting (Codecov), <10min pipeline. Reusable composite actions (setup-backend, setup-frontend), concurrency control, badges. All YAML validated. See: 7-3-ci-cd-pipeline-setup.md, docs/ci-cd-setup.md
  7-4-production-deployment-configuration: done  # ✅ DONE 2025-12-09: All 4 ACs satisfied, all 5 tasks complete. docker-compose.prod.yml with resource limits/restart policies/health checks/log rotation. K8s manifests (6 files: namespace, configmaps-secrets, api/worker/frontend deployments, services). /health (liveness) + /ready (readiness) endpoints with 5s timeout. Secrets validation (fail-fast for insecure production defaults). 42 tests passing (19 infrastructure unit + 12 secrets unit + 11 health integration). Production-ready. See: 7-4-production-deployment-configuration.md, automation-summary-story-7-4.md
  7-5-monitoring-and-observability: done  # ✅ DONE 2025-12-08: Code review APPROVED. All 4 ACs satisfied. /metrics endpoint (Prometheus format), 3 Grafana dashboards (api-latency, error-rates, queue-depth), AlertManager (5% error threshold, 5min window), structured JSON logging (structlog + X-Request-ID correlation). 46 tests (15 metrics unit + 18 logging unit + 13 integration). RED method compliance, production-ready Docker Compose. See: 7-5-monitoring-and-observability.md
  7-6-backend-unit-test-fixes: done  # ✅ DONE 2025-12-08: TD-5.15-1: All frontend unit tests fixed. 1458/1458 tests passing. Fixed: document-list-delete (dropdown menu UI), processing-tab (inline filter structure), audit-log-filters (Radix UI mocks). All 5 ACs satisfied. See: 7-6-backend-unit-test-fixes.md
  7-7-async-qdrant-migration: done  # ✅ DONE 2025-12-09: All 4 ACs satisfied. AsyncQdrantClient replaces sync client (AC-7.7.1), ChunkService uses native async calls (AC-7.7.2), SearchService uses native async calls (AC-7.7.3), 100 concurrent requests validated (AC-7.7.4). 50 unit tests passing. No asyncio.to_thread wrappers. Code review APPROVED. See: code-review-story-7-7.md
  7-8-ui-scroll-isolation-fix: done  # ✅ DONE 2025-12-08: Scroll isolation implemented (overscroll-behavior:contain applied to all scrollable containers). AC1-AC3 satisfied. Tech debt deferred: TD-7.8-1 (chunk position sync - extraction module issue, P3), TD-7.8-2 (semantic search only - feature enhancement, P4). See: 7-8-ui-scroll-isolation-fix.md, tech-debt-chunk-viewer.md
  7-9-llm-model-registry: done  # ✅ DONE 2025-12-08: LLM Model Registry COMPLETED. All 12 ACs satisfied. Backend: LLMModel model, ModelRegistryService (CRUD, connection testing, API key encryption), 6 admin endpoints + 3 public endpoints, AuditService integration. Frontend: useModelRegistry hook (React Query), ModelTable component, ModelFormModal (type-specific fields), /admin/models page. Tests: 97 total (32 backend unit, 26 integration, 21 frontend hook, 18 frontend component). Multi-provider (Ollama, OpenAI, Azure, Gemini, Anthropic, Cohere). Production-ready. See: 7-9-llm-model-registry.md
  7-10-kb-model-configuration: done  # ✅ DONE 2025-12-09: All 10 ACs satisfied, 7/7 tasks complete. Backend: Migration (model FKs, RAG params, Qdrant metadata), KB service (model validation, embedding lock), generation service (KB model usage), embedding worker (KB embedding config). Frontend: kb-create-modal (model dropdowns), kb-settings-modal (change warning), useAvailableModels hook. Tests: 65 unit (KB schemas/perms), 64 component (kb-create/settings modal), 21 integration (require Docker). Production-ready. See: 7-10-kb-model-configuration.md
  7-11-navigation-restructure-rbac-default-groups: done  # ✅ DONE 2025-12-09: All 20 ACs satisfied, all 10 tasks complete. Backend: PermissionService (PermissionLevel enum, cumulative check, @require_permission decorator, last-admin safety). Frontend: MainNav (Operations/Admin dropdowns), OperatorGuard, AdminGuard route protection. System groups (Users/Operators/Administrators) with permission_level hierarchy. 75 tests validated (25 backend unit + 29 guard + 21 main-nav). Code review APPROVED. See: 7-11-navigation-restructure-rbac-default-groups.md, automation-summary-story-7-11.md
  # Stories 7.12-7.17: KB-Level Configuration (correct-course 2025-12-09)
  # Feature: Per-KB RAG parameters, system prompts, and presets
  # Architecture: Three-layer config (Request → KB → System defaults)
  # See: docs/sprint-artifacts/correct-course-kb-level-config.md
  7-12-kb-settings-schema: done  # ✅ DONE 2025-12-09: All 11 ACs satisfied, 9/9 tasks complete. 6 enums (ChunkingStrategy, RetrievalMethod, CitationStyle, UncertaintyHandling, TruncationStrategy, PoolingStrategy), 8 sub-configs (ChunkingConfig, RetrievalConfig, RerankingConfig, GenerationConfig, NERConfig, DocumentProcessingConfig, KBPromptConfig, EmbeddingConfig), KBSettings composite with preset field. Re-indexing detection (REINDEX_FIELDS ClassVar, requires_reindex(), detect_reindex_fields(), get_reindex_warning()). 138/138 tests PASSED, linting clean. Production-ready. See: 7-12-kb-settings-schema.md
  7-13-kb-config-resolver-service: done  # ✅ DONE 2025-12-09: Code review APPROVED. All 8 ACs satisfied, 56/56 tests (38 unit + 18 integration). Three-layer resolution (Request → KB → System), Redis caching (5min TTL), TypeVar generic resolution, graceful degradation. See: 7-13-kb-config-resolver-service.md (5 pts)
  7-14-kb-settings-ui-general: done  # ✅ DONE 2025-12-10: KB Settings UI - General Panel COMPLETED. All 8 ACs satisfied (Tab structure, Chunking section, Retrieval section, Generation section, Reset to defaults, Save settings, Validation feedback, Settings API). 107 tests passing (90 frontend + 17 backend integration). Frontend: useKBSettings hook (React Query, optimistic updates, 5min stale), GeneralPanel with ChunkingSection/RetrievalSection/GenerationSection components, Zod validation. Backend: GET/PUT /settings endpoints with audit logging. Code review APPROVED. Production-ready. See: code-review-story-7-14.md
  7-15-kb-settings-ui-prompts: done  # ✅ DONE 2025-12-10: KB Settings UI - Prompts Panel COMPLETED. All 8 ACs satisfied (System prompt editor, Character count/validation, Variables help, Citation style selector, Uncertainty handling, Response language, Prompt preview, Template loading). PromptsPanel component with Zod validation, preview modal, template confirmation dialog. 38 tests passing. Integrated with KbSettingsModal. Production-ready. See: 7-15-kb-settings-ui-prompts.md
  7-16-kb-settings-presets: done  # ✅ DONE 2025-12-10: KB Settings Presets COMPLETED. All 8 ACs satisfied (Preset dropdown, Legal/Technical/Creative/Code/General presets, Confirmation dialog, Preset detection). 60 tests passing (30 unit + 15 integration + 15 E2E). Backend: kb_presets.py with preset definitions, 3 API endpoints. Frontend: PresetSelector component with AlertDialog. Code review APPROVED. See: 7-16-kb-settings-presets.md
  7-17-service-integration: done  # ✅ DONE 2025-12-10: Service Integration COMPLETED. 5/6 ACs fully satisfied (SearchService KB config, GenerationService KB config, System prompt, Request overrides, Audit logging). AC-7.17.4 (document worker chunking) tracked as tech debt. 27 tests passing (17 integration + 10 E2E). Code review APPROVED WITH NOTES. EXTENDED 2025-12-17: ChunkService now uses KB's embedding model for chunk search via KBConfigResolver. Fixed qdrant-client 1.16+ API (search→query_points). See: 7-17-service-integration.md
  epic-7-retrospective: done  # ✅ COMPLETED 2025-12-17: Retrospective facilitated. 32 stories delivered (116 SP). Key learnings: Feature flag + Strategy pattern for safe rollouts, KB-level configuration power, RBAC simplicity. Critical action item: Testing documentation gaps identified (API endpoints, credentials, auth flow, hybrid setup). 6 action items documented. See: docs/sprint-artifacts/epic-7-retrospective-2025-12-17.md

  # Epic 8: GraphRAG Integration (18 stories)
  # NEW 2025-12-08: Knowledge graph-augmented retrieval using Neo4j and LLM-based entity extraction.
  # Core capabilities: Domain schema management, entity extraction, graph-augmented search,
  # retrieval strategy abstraction, schema evolution with re-extraction.
  # Technology: Neo4j Community Edition, LLM-based NER via LiteLLM, configurable domains per KB.
  # Story 8-0 added 2025-12-17: History-Aware Query Rewriting (chat memory improvement)
  # Story 8-16 added 2025-12-08: E2E Test Automation (split from Story 7-1)
  # Story 8-17 added 2025-12-17: Hybrid BM25 + Vector Retrieval
  # Total Story Points: 81 (was 65, +5 for 8-0, +8 for 8-17, +3 for 8-16 correction)
  # Tech Debt Sprint (Pre-Epic 8) - Stories 7-18 through 7-23
  # Purpose: Resolve accumulated tech debt before starting GraphRAG epic
  # Duration: 2025-12-10 to 2025-12-12 (3 days)
  # Total Effort: ~23h (6 prioritized stories from 16 open items)
  # Source: docs/sprint-artifacts/epic-7-tech-debt.md
  7-18-document-worker-kb-config: done  # ✅ DONE 2025-12-10: Code review APPROVED. 12 tests pass, ruff clean. KB config loading with graceful fallback, proper async patterns.
  7-19-export-audit-logging: done  # ✅ DONE 2025-12-10: Code review APPROVED. 10 tests pass, ruff clean. DOCUMENT_EXPORT_FAILED enum, log_export_failed(), error truncation to 500 chars.
  7-20-feedback-button-integration: done  # ✅ DONE 2025-12-10: Code review APPROVED. 7 tests pass, eslint clean. Feedback button wired to FeedbackModal+RecoveryModal, disabled during streaming.
  7-21-draft-validation-warnings: done  # ✅ DONE 2025-12-10: Code review APPROVED. useCitationValidation hook (debounced 500ms), CitationWarningBanner component, renumberCitations utility. 39/39 tests passing (19 hook + 20 component). Orphaned/unused citation detection, dismissable warnings, auto-fix renumbering. Production-ready. Resolves TD-4.6-1. See: code-review-stories-7-21-7-22-7-23.md
  7-22-sse-reconnection: done  # ✅ DONE 2025-12-10: Code review APPROVED. useSSEReconnection hook with exponential backoff (1s→2s→4s→8s→max 30s), max 5 retries, Last-Event-ID tracking, polling fallback. ReconnectionIndicator + ReconnectionIndicatorInline components. 40/40 tests passing. Production-ready. Resolves TD-4.2-1. See: code-review-stories-7-21-7-22-7-23.md
  7-23-feedback-analytics: done  # ✅ DONE 2025-12-10: Code review APPROVED. FeedbackAnalyticsService (by_type, by_day trend, recent), GET /admin/feedback/analytics endpoint, useFeedbackAnalytics hook (React Query 2min cache), FeedbackAnalyticsPage with PieChart/LineChart/table. 43/43 tests passing (9 backend + 34 frontend). Production-ready. Resolves TD-4.8-2. See: code-review-stories-7-21-7-22-7-23.md
  # Stories 7.24-7.26: KB Lifecycle Management (added 2025-12-10)
  # Feature: Archive, Restore, and Delete operations for Knowledge Bases
  # Architecture: Transactional outbox for Qdrant payload updates, cascade to documents
  # See: docs/sprint-artifacts/sprint-change-proposal-2025-12-10.md
  7-24-kb-archive-backend: done  # ✅ DONE 2025-12-10: All 6 ACs satisfied. KB archive endpoint, cascade to documents (archived_at), outbox event (kb.archive) for Qdrant payload updates. KBService.archive() with ADMIN permission check, audit logging. 24 integration tests passing (test_kb_archive_api.py). Production-ready. (5 pts)
  7-25-kb-restore-backend: done  # ✅ DONE 2025-12-10: All 6 ACs satisfied. KB restore endpoint, clears archived_at on KB and all documents, outbox event (kb.restore) for Qdrant payload reset. KBService.restore() with ADMIN permission check. 24 integration tests passing (test_kb_archive_api.py). Production-ready. (3 pts)
  7-26-kb-delete-archive-ui: done  # ✅ DONE 2025-12-10: All ACs satisfied. Archive/Restore/Delete UI via KBActionsMenu component. ArchiveKBDialog (document count warning), RestoreKBDialog, DeleteKBDialog (type-to-confirm). useKBActions hook. Admin-only visibility (isAdmin check). 39 frontend tests passing (20 dialog + 19 actions menu). Production-ready. (3 pts)
  # Story 7.27: Queue Monitoring Enhancement (added 2025-12-10)
  # Feature: Enhanced queue monitoring with operator access, per-step timing, bulk retry, filtering
  # See: docs/sprint-artifacts/sprint-change-proposal-queue-monitoring-enhancement.md
  7-27-queue-monitoring-enhancement: done  # ✅ DONE 2025-12-10: All 19 ACs satisfied (AC-7.27.1 through AC-7.27.19). Backend: TaskInfo schema extended (processing_steps, current_step, step_errors), bulk_retry_failed() endpoint with outbox events, document_status filter, get_current_operator_or_admin dependency (RBAC permission_level >= 2). Tests: 33 unit tests (28 queue monitor + 5 auth dependencies), 14 integration tests. Operator access preserved, superuser always granted. See: 7-27-queue-monitoring-enhancement.md (3 pts)
  # Stories 7.28-7.31: Markdown-First Document Processing (added 2025-12-11)
  # Feature: Generate markdown from PDF/DOCX for precise chunk position highlighting in viewer
  # Resolves: TD-5.26-2 (chunk viewer position accuracy for non-markdown formats)
  # See: docs/sprint-artifacts/sprint-change-proposal-markdown-first-processing.md
  7-28-markdown-generation-backend: done  # ✅ DONE 2025-12-11: All 6 ACs satisfied. markdownify dependency, elements_to_markdown() function, ParsedContent.markdown_content field, MinIO storage updated. 21 unit tests (17 markdown conversion + 4 field tests). Ruff clean. See: 7-28-markdown-generation-backend.md (3 pts)
  7-29-markdown-content-api: done  # ✅ DONE 2025-12-11: GET /documents/{id}/markdown-content endpoint with permission checks. MarkdownContentResponse schema, 200/400/403/404 responses. 10 integration tests (100% pass). Ruff clean. See: 7-29-markdown-content-api.md (2 pts)
  7-30-enhanced-markdown-viewer: done  # ✅ DONE 2025-12-11: Code review APPROVED. All 6 ACs satisfied. useMarkdownContent hook (404 handling), EnhancedMarkdownViewer (char_start/char_end highlighting, dark mode, scrollIntoView), chunks page integration. 34/34 tests passing (7 hook + 27 component). Graceful fallback to original viewers. ESLint warning (img vs Image) acceptable for markdown. Quality: 95/100. Production-ready. (3 pts)
  7-31-view-mode-toggle: done  # ✅ DONE 2025-12-11: Code review APPROVED. All 6 ACs satisfied. useViewModePreference hook (localStorage persistence, markdown fallback), ViewModeToggle component (shadcn ToggleGroup, disabled tooltip). 22/22 unit tests passing (10 hook + 12 component), 12 E2E tests scaffolded. Completes Markdown-First feature chain (7-28→7-29→7-30→7-31). Quality: 95/100. Production-ready. (2 pts)
  # Story 7.32: Docling Document Parser Integration (added 2025-12-16)
  # Feature: Alternative document parser with better table extraction and layout analysis
  # Feature-flagged (LUMIKB_PARSER_DOCLING_ENABLED), KB-level setting (processing.parser_backend)
  # See: docs/sprint-artifacts/7-32-docling-parser-integration.md, correct-course-handover-docling-integration.md
  7-32-docling-parser-integration: done  # ✅ DONE 2025-12-17: Code review APPROVED. 16/17 ACs satisfied (AC-7.32.3 UI deferred as optional). Feature flag LUMIKB_PARSER_DOCLING_ENABLED, KB setting processing.parser_backend (unstructured/docling/auto), strategy pattern in parsing.py, docling_parser.py module. 30 unit + 9 integration tests passing. Ruff clean. Production-ready. (2 pts)

  epic-8: contexted  # ✅ CONTEXTED 2025-12-08: Tech spec generated with comprehensive design, Neo4j infrastructure, domain management, entity extraction, graph-augmented retrieval. UPDATED 2025-12-17: Added Story 8.0 (Query Rewriting) and 8.17 (Hybrid BM25). See: docs/sprint-artifacts/tech-spec-epic-8.md
  8-0-history-aware-query-rewriting: done  # ✅ DONE 2025-12-17: All 10 ACs satisfied. QueryRewriterService (pronoun/reference resolution, 5s timeout), Admin > LLM Configuration dropdown, ConversationService integration. 14 unit + 9 integration tests. Code review APPROVED. BUG FIX 2025-12-18: Fixed log_llm_call() parameter (trace_id→ctx) that caused follow-up questions to fail. (5 pts)
  8-1-neo4j-docker-infrastructure: backlog  # Neo4j Docker setup, Python driver, health checks (2 pts)
  8-2-domain-data-model: backlog  # PostgreSQL schema for domains, entity types, relationships (3 pts)
  8-3-system-domain-templates: backlog  # 5 pre-built templates: IT Ops, Legal, Sales, PM, HR (3 pts)
  8-4-llm-domain-recommendation: backlog  # LLM-powered schema suggestions from documents (5 pts)
  8-5-domain-management-api: backlog  # CRUD endpoints for domains, entity types, relationships (5 pts)
  8-6-domain-management-ui: backlog  # Domain creation wizard, visual schema editor, graph viz (8 pts)
  8-7-kb-domain-linking: backlog  # Link domains to KBs, multiple domain support, re-extraction triggers (3 pts)
  8-8-entity-extraction-service: backlog  # LLM-based NER, Neo4j storage, deduplication (5 pts)
  8-9-document-processing-graph-integration: backlog  # Celery pipeline integration, batch processing (5 pts)
  8-10-graph-query-service: backlog  # Neo4j queries: entity search, neighborhood, path finding (3 pts)
  8-11-graph-augmented-retrieval: backlog  # Vector-first + Graph-augment retrieval implementation (5 pts)
  8-12-retrieval-strategy-abstraction: backlog  # Strategy interface, registry, auto-selection (3 pts)
  8-13-llm-schema-enrichment: backlog  # Unrecognized entity detection, enrichment suggestions (5 pts)
  8-14-schema-evolution-reextraction: backlog  # Schema versioning, drift detection, re-extraction jobs (5 pts)
  8-15-batch-reprocessing-worker: backlog  # Dedicated Celery worker, rate limiting, progress tracking (3 pts)
  8-16-e2e-test-automation: backlog  # ✅ NEW 2025-12-08: SPLIT from Story 7-1. Playwright Docker config, GitHub Actions E2E workflow, 70+ E2E tests for Epic 3-8. Depends on Story 7-1. (5 pts) See: 8-16-e2e-test-automation.md
  8-17-hybrid-bm25-vector-retrieval: backlog  # ✅ NEW 2025-12-17: Combines lexical (BM25/Elasticsearch) and semantic (vector) search. RRF result fusion. KB-level config. Admin UI. Depends on 8-12. (8 pts)
  epic-8-retrospective: optional

  # Epic 9: Hybrid Observability Platform (14 stories)
  # NEW 2025-12-14: Comprehensive observability with distributed tracing, chat persistence, LLM cost tracking
  # Technology: PostgreSQL + TimescaleDB (always-on), LangFuse (optional)
  # FRs Covered: FR111-FR125 (15 requirements)
  # Total Story Points: 62
  # Target Sprint: Sprint 17-21
  # See: docs/epics/epic-9-observability.md, docs/sprint-artifacts/tech-spec-epic-9-observability.md
  epic-9: contexted  # ✅ CONTEXTED 2025-12-14: Tech spec + epic created with comprehensive design, PostgreSQL schema, provider registry pattern, 4-phase implementation. See: docs/sprint-artifacts/tech-spec-epic-9-observability.md
  # Phase 1: Core Infrastructure (13 pts)
  9-1-observability-schema-and-models: done  # ✅ DONE 2025-12-15: Code review APPROVED. TimescaleDB schema (6 tables + hypertables), SQLAlchemy 2.0 models, W3C-compliant trace IDs, comprehensive indexes. 76 unit tests + 54 integration tests passing. See: code-review-stories-9-1-9-2-9-3.md (5 pts)
  9-2-postgresql-provider-implementation: done  # ✅ DONE 2025-12-15: Code review APPROVED. PostgreSQLProvider with fire-and-forget pattern, text truncation utilities, all 10 ACs satisfied. Provider always enabled. See: code-review-stories-9-1-9-2-9-3.md (5 pts)
  9-3-trace-context-and-core-service: done  # ✅ DONE 2025-12-15: Code review APPROVED. TraceContext dataclass, ObservabilityService singleton with provider fan-out, span() async context manager. 130 tests total. See: code-review-stories-9-1-9-2-9-3.md (3 pts)
  # Phase 2: Pipeline Instrumentation (13 pts)
  9-4-document-processing-instrumentation: done  # ✅ DONE 2025-12-15: All 11 ACs implemented. 15 unit + 8 integration tests passing. Fire-and-forget telemetry, TraceContext propagation. Code review APPROVED. See: code-review-stories-9-4-9-5-9-6.md (5 pts)
  9-5-chat-rag-flow-instrumentation: done  # ✅ DONE 2025-12-15: All 11 ACs implemented. 12 unit + 9 integration tests passing. Privacy-first design, streaming trace continuity. Code review APPROVED. See: code-review-stories-9-4-9-5-9-6.md (5 pts)
  9-6-litellm-integration-hooks: done  # ✅ DONE 2025-12-15: All 10 ACs implemented. 18 unit + 12 integration tests passing. ObservabilityCallback, fire-and-forget pattern. Code review APPROVED. See: code-review-stories-9-4-9-5-9-6.md (3 pts)
  # Phase 3: API & UI (18 pts)
  9-7-observability-admin-api: done  # ✅ DONE 2025-12-15: All 10 ACs satisfied. ObservabilityQueryService, 5 admin endpoints (traces, trace detail, chat-history, document timeline, stats). 811 lines integration tests. Code review APPROVED 96/100. See: code-review-stories-9-7-9-8-9-9-9-10.md (5 pts)
  9-8-trace-viewer-ui-component: done  # ✅ DONE 2025-12-15: All 10 ACs satisfied. WaterfallTimeline (CSS-based), TraceList, SpanDetail, TraceFilters components. useTraces hook (30s polling). 7 unit tests. Code review APPROVED 96/100. See: code-review-stories-9-7-9-8-9-9-9-10.md (5 pts)
  9-9-chat-history-viewer-ui: done  # ✅ DONE 2025-12-15: All 10 ACs satisfied. ChatSessionList, ConversationThread, ExportDialog (JSON/CSV), CitationDisplay. useChatHistory (infinite scroll). 35 tests (5 files). Code review APPROVED 96/100. See: code-review-stories-9-7-9-8-9-9-9-10.md (5 pts)
  9-10-document-timeline-ui: done  # ✅ DONE 2025-12-15: All 10 ACs satisfied. ProcessingTimeline, TimelineStep, StepDetail (step-specific metrics), StatusIcon. useDocumentTimeline (2s polling while processing). 36 tests (4 files). Code review APPROVED 96/100. See: code-review-stories-9-7-9-8-9-9-9-10.md (3 pts)
  # Phase 4: Advanced Features (18 pts)
  9-11-langfuse-provider-implementation: ready-for-dev  # Optional LangFuse integration, SDK wrapper (5 pts). Context: 9-11-langfuse-provider-implementation.context.xml
  9-12-observability-dashboard-widgets: ready-for-dev  # LLM cost charts, processing metrics, chat volume (5 pts). Context: 9-12-observability-dashboard-widgets.context.xml
  9-13-metrics-aggregation-worker: ready-for-dev  # Celery beat job for hourly/daily aggregations (5 pts). Context: 9-13-metrics-aggregation-worker.context.xml
  9-14-data-retention-and-cleanup: ready-for-dev  # TimescaleDB policies, configurable retention (3 pts). Context: 9-14-data-retention-and-cleanup.context.xml
  9-15-kb-debug-mode-and-prompt-integration: done  # ✅ DONE 2025-12-16: All 23 ACs satisfied, 8 tasks completed. debug_mode in KBSettings, KB prompt config integration in ConversationService, Debug panel UI, 68 unit tests passing. Code review APPROVED 2025-12-16. (8 pts)
  epic-9-retrospective: optional
